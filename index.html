<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" href="styles.css">
	
	<script src="lib/d3.min.js" charset="utf-8"></script>
	<script src="lib/d3-tip.min.js"></script>
    <script src="lib/jquery-2.2.3.min.js"></script>
	
    <script src="bubbleview.js"></script>
    <script src="zoomview.js"></script>
    <script src="teamstats.js"></script>

    <script>
        var team="Golden State Warriors";

        function drawAll() {

            //d3.selectAll(".chart").remove();
            d3.select(".bubblechart").remove();
            d3.select(".d3-tip").remove();
            drawBubbles(bubbleSvg, 0, 0, width, height, year, false);
            drawFullTeamChange(year);
        }

        function drawFullTeamChange(year) {
            drawTeamChange(year);
            drawTeamStats(teamSvg, 0, 0, width, 200, year, team);
        }


        function drawTeamChange(year) {
            drawZoom(zoomSvg, 0, 0, width, height - 480, year, team);
            drawField(fieldSvg, 0, 0, width, height - 280, year, team);
            drawBubbles(miniBubbleSvg, 0, 0, miniw, minih, year, true);
        }


        function drawBubbles(svg, x, y, w, h, year, back) {
            d3.select(".backbubble").remove();
            if (back) {
                svg.append("rect")
                    .attr("class", "backbubble")
                    .attr("fill", "white")
                    //.attr("opacity", "0")
                    .attr("x", x)
                    .attr("y", y)
                    .attr("width", w)
                    .attr("height", h);
            }
    
            drawCircles(theData.filter(function(d) {return d.year == year}), "srs", "leaguerank", "playoffrank", "team", svg, x, y, w, h);

            d3.selectAll(".teambubble")
                .on("click", function(d) {
                    team = d.team;
                    $("#bubbleheader h1").text(team);
                    if (view === "bubble") {
                        scrollMe("zoom");
                    }
                    drawFullTeamChange(window.year);
                });

            d3.select(".backbubble")
                .on("click", function(d) {
                    if (!(view === "bubble")) {
                        scrollMe("bubble");
                    }
                });
        }

        function drawZoom(svg, x, y, w, h, year, team) {
            drawTransfers(theData, team, year, "PER", svg, x, y, w, h);
        }

        function drawTeamStats(svg, x, y, w, h, year, team) {
            drawTs(theData, team, year, svg, x, y, w, h);
        }

        function drawField(svg, x, y, w, h, year, team) {
            svg.append("g")
                .attr("class", "chart fieldchart")
                .append("image")
                .attr("xlink:href", "team/fieldview.png")
                .attr("x", x)
                .attr("y", y)
                .attr("width", w)
                .attr("height", h);
        }
    </script>
</head>

<body>
    <div class="wrapper" id="wrapper">
			<main>
					<div id="InfoVis">
                            <div class="allviss">
                                <div class="scrollable">
                                    <div class="visualization" id="bubblevis"></div>
                                    <div class="headerblocker" id="zoomblocker">
                                        <div class="visualization" id="bubbleheader">
                                            <h1>Golden State Warriors</h1>
                                            <h2>2015</h2>
                                        </div>
                                        <div class="visualization" id="minibubbles"></div>
                                    </div>
                                    <div class="visualization" id="zoomvis"></div>
                                    <div class="visualization" id="teamvis"></div>
                                    <div class="headerblocker" id="fieldblocker"></div>
                                    <div class="visualization" id="fieldvis"></div>
                                </div>
                                <div class="visualization" id="timelinefooter">
                                    <p>
                                        <input class="timeline" type="range" min="1984" max="2015" id="year" value=2015>
                                        <p id="yearSlider">2015</p>
                                    </p>
                                </div>
                            </div>

							<script type="text/javascript">

                                var view = "bubble";


                                $(window).scroll(movescroll);
                                movescroll();

                                $('#bubbleheader').css("width", "" + ($('#wrapper').width() - $('#minibubbles').width()) + "px");

                                function scrollMe(where) {
                                    if (where === "bubble") {
                                        $("html, body").animate({ scrollTop: $('#bubblevis').offset().top }, 600);
                                        $('#bubbleheader').removeClass('stick');
                                        $('#minibubbles').removeClass('stick');
                                        $('#minibubbles').css("left", "");
                                        view = "scrollingbubble";
                                    } else if (where === "zoom") {
                                        $("html, body").animate({ scrollTop: $('#zoomblocker').offset().top }, 600);
                                        view = "scrollingzoom";
                                    } else if (where === "field") {
                                        $("html, body").animate({ scrollTop: $('#fieldblocker').offset().top }, 600);
                                        view = "scrollingfield";
                                    }
                                }

                                function movescroll() {
                                    var window_top = $(window).scrollTop();

                                    if (view === "scrollingbubble" && window_top == $('#bubblevis').offset().top) {
                                        view = "bubble";
                                    } else if (view === "scrollingzoom" && window_top == $('#zoomblocker').offset().top) {
                                        $('#bubbleheader').addClass('stick');
                                        $('#minibubbles').addClass('stick');
                                        $('#minibubbles').css("left", $('#zoomblocker').offset().left + ($('#wrapper').width() - $('#minibubbles').width()) + "px");
                                        view = "zoom";
                                    } else if (view === "scrollingfield" && window_top == $('#fieldblocker').offset().top) {
                                        view = "field";
                                    } else if (view === "bubble" && window_top > $('#bubblevis').offset().top) {
                                        scrollMe("zoom");
                                    } else if (view === "zoom") {
                                        if (window_top < $('#zoomblocker').offset().top) {
                                            scrollMe("bubble");
                                        } else if (window_top > $('#zoomblocker').offset().top) {
                                            scrollMe("field");
                                        }
                                    } else if (view === "field") {
                                        if (window_top < $('#fieldblocker').offset().top) {
                                            scrollMe("zoom");
                                        }
                                    }
                                }
                                $(window).scrollTop(0);

                                var width = 1000,
                                    height = window.innerHeight - $('#timelinefooter').height() ;

                                var miniw = $('#minibubbles').width(),
                                    minih = $('#minibubbles').height();


                                var bubbleSvg = d3.select("#bubblevis")
                                    .append("svg")
                                    .attr("width", width)
                                    .attr("height", height)

                                var miniBubbleSvg = d3.select("#minibubbles")
                                    .append("svg")
                                    .attr("width", miniw)
                                    .attr("height", minih)

                                var zoomSvg = d3.select("#zoomvis")
                                    .append("svg")
                                    .attr("width", width)
                                    .attr("height", height - $('#zoomblocker').height() - 200)

                                var teamSvg = d3.select("#teamvis");

                                var fieldSvg = d3.select("#fieldvis")
                                    .append("svg")
                                    .attr("width", width)

                                    .attr("height", height - $('#zoomblocker').height())

                                //var view = "bubble";

                                window.year = 2015;


								d3.select("#year").on("input", function() {
									year = +this.value
									document.getElementById("yearSlider").innerHTML= year;
                                    $("#bubbleheader h2").text(year);

                                    drawAll();
                                });

                                var theData;

                                d3.json("combined.json", function(data) {
                                    theData = data;
                                    drawAll();
                                });
							</script>
					</div>							
			</main>
		
			<!--<footer>-->
				<!--<p>Yves Langeraert - <a href = "https://thetuftersblog.wordpress.com/">The Tufters</a> - InfoVis1516</p>-->
			<!--</footer>-->
	</div>
</body>
</html>
